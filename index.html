<html>
  <head>
    <title>Force Chart</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <style>
    * {
      /*font-family: sans-serif;*/
    }
    
    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
    }
    
    .axis path { stroke: none; }
    
    .axis { font-size: 14px; }
    
    .y.axis .tick line {
      stroke-dasharray: 1, 8;
    }
    </style>
  </head>
  <body>
     <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
     <script src="force-chart.js"></script>
     <script>
       var margin = { top: 10, left: 80, bottom: 30, right: 10 },
           width = 800 - margin.left - margin.right,
           height = 600 - margin.top - margin.bottom;
       
       var x = function(d) { return d["Petal.Length"]; },
           y = function(d) { return d["Species"]; },
           r = function(d) { return d["Sepal.Length"] * d["Sepal.Width"]; };
       
       var xScale = d3.scale.linear().range([0, width]),
           yScale = d3.scale.ordinal().rangeRoundBands([height, 0]),
           rScale = d3.scale.linear().range([3, 10]),
           fillScale = d3.scale.threshold()
            .domain([1.5, 4, 5, 6])
            .range(["#21313E", "#1F6165", "#389576", "#84C671", "#EFEE69"]),
           strokeScale = d3.scale.linear()
            .domain([-20, 0, 20])
            .range(["brown", "white", "steelblue"]);
       
       var xAxis = d3.svg.axis().scale(xScale).orient("bottom"),
           yAxis = d3.svg.axis().scale(yScale).orient("left");
       
       var bubbleChart = d3.forceChart()
         .size([width, height])
         .x(function(d) { return xScale(x(d)); })
         .y(function(d) { return yScale(y(d)) + yScale.rangeBand()/2; })
         .r(function(d) { return rScale(r(d)); })
         .padding(0)
         .xGravity(25)
         .yGravity(function(d) {
           return d.y0 - d.y <= 0? 1000 : 1;
         })
         .yStart(function(d) {
           return Math.random()*50 - 100;
         })
         .shape("square");
         /*
         .tickUpdate(function(nodes) {
           nodes.selectAll("rect")
            .style("stroke", function(d) { return strokeScale(d.x - d.x0); })
            .style("stroke-width", function(d) { return Math.abs(d.x - d.x0) / 10 + 0.1; });
         });*/
       
       var svg = d3.select("body").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      
      d3.json("iris.json", function(error, iris) {
        if (error) throw error;
        
        xScale.domain([0, d3.max(iris, x)]);
        yScale.domain(iris.map(y));
        rScale.domain(d3.extent(iris, r));
        
        svg.append("g").attr("class", "x axis").call(xAxis)
          .attr("transform", "translate(0," + height + ")");
          
        svg.append("g").attr("class", "y axis").call(yAxis) 
          .selectAll(".tick line")
            .attr("x2", width);
        
        svg.call(bubbleChart, iris)
          .selectAll(".node").append("text")
            .attr('font-family', 'FontAwesome')
            .attr('font-size', function(d) { return d.r*2 + 'px'} )
            .style("fill", function(d) { return fillScale(x(d)); })
            .text(function(d) { return "\uf06c"; });
          /*
            .append("rect")
            .attr("x", function(d) { return -d.r; })
            .attr("y", function(d) { return -d.r; })
            .attr("width", function(d) { return 2*d.r; })
            .attr("height", function(d) { return 2*d.r; })
            .style("fill", function(d) { return fillScale(x(d)); });
            */
      });
        
     </script>
  </body>
</html>